/* (c) Jonathan Gotti - licence: https://github.com/malko/stpl/LICENCE.txt */
(function(t){"use strict";function r(t){return t[p](/[<>"'`]|&(?!amp;)/g,function(t){return y[t]})}function n(t,r){return g[t]=r[p](/^\s+|\s+$/g,""),this}function e(t,r){return n(r||t[a]("rel"),t.innerHTML),t.parentNode.removeChild(t),this}function i(t,r){return h[t]=r||d[t],this}function s(){var t,r,n=document;if(n.querySelectorAll)t=n.querySelectorAll('script[type="'+f.tplType+'"][rel]');else{var i=n.getElementsByTagName("script");for(r=i[c],t=[];r--;)i[r][a]("type")===f.tplType&&i[r][a]("rel")&&t.push(i[r])}for(r=t[c];r--;)e(t[r]);return this}function u(t,r,n){var e,s;if(~r.indexOf("|")){var o,f,a,g=r.split("|");for(r=g.shift(),o=u(t,r,n),e=0,s=g[c];s>e;e++)g[e].match(/^\s*!?=/)?g[e][p](/^\s*(!?)=(.*)\s*$/,function(t,r,n){o=r?o!=n?o:!1:o==n?o:!1}):(~(a=g[e].indexOf(":"))?((f=g[e][l](a+1).split(",")).splice(0,0,o),g[e]=g[e][l](0,a)):f=[o],h[g[e]]||i(g[e]),o=h[g[e]].apply(t,f));return o}for(r.match(/^\//)&&(r=r[l](1),n="");r.match(/^..\//);)n=~n.indexOf(".")?"":n[p](/\.[^\.]*$/,""),r=r[p](/^..\//,"");if(r=r[p](/^\.+/,""),n=n[p](/^\/+/,"")[p](/^\.+/,""),r=(n||"")+(n&&r?".":"")+r,!r[c])return t;r=r.split(/\s*\.\s*/);var y=t;for(e=0,s=r[c];s>e;e++){if(!(r[e]in y))return null;y=y[r[e]]}return y}function o(t,n,e){return e||(e=""),t[p](/\{\{\s*#([^\{\s]+?)\}\}([\s\S]*?)\{\{\/\1\}\}/g,function(t,r,i){var s,f=[],c=u(n,r,e),p=(e?e+".":"")+r;if(!c)return"";for(s in c)c.hasOwnProperty(s)&&f.push(o(i,n,p+"."+s));return f.join("")})[p](/\{\{\s*(([^\{\s\|]+?)(\|[^\{\s]+?)?)\s*(!)?\?\s*\}\}([\s\S]*?)\{\{\s*\?\s*(\1|\2)\s*\}\}/g,function(t,r,i,s,f,p){var a=u(n,r,e),l=a?a instanceof Array?a[c]:!0:!1;return f&&(l=!l),l?o(p,n,e):""})[p](/\{\{\s*>\s*([a-z_][a-z_0-9-]*)\s*\}\}/gi,function(t,r){return g[r]?o(g[r],n,e):""})[p](/\{\{\{\s*([^\{\s]*?)\s*\}\}\}/g,function(t,i){return r(u(n,i,e))})[p](/\{\{\s*([^\{\s]*?)\s*\}\}/g,function(t,r){return u(n,r,e)})}function f(t,r){return void 0===g[t]&&(s(),void 0===g[t])?!1:o(g[t],r)}var c="length",p="replace",a="getAttribute",l="substr",g={},h={empty:function(t){return!!(!t||"0"===t||t instanceof Array&&!t[c])},jsonEncode:function(t){return JSON.stringify(t)},lowerCase:function(t){return(""+t).toLowerCase()},ucFirst:function(t){return t=""+t,t[l](0,1).toUpperCase()+t[l](1)},upperCase:function(t){return(""+t).toUpperCase()}},y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},d="undefined"!=typeof global?global:Function("return this;")();f.tplType="text/stpl",f.registerScriptTag=e,f.registerString=n,f.registerFilter=function(t,r){return i(t,r),this},f.preload=s,f.renderString=o,t.stpl=f})("object"==typeof exports?exports:this);