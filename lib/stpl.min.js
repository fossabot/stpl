/* (c) Jonathan Gotti - licence: https://github.com/malko/stpl/LICENCE.txt */
(function(t){"use strict";function e(t){return t.replace(/[<>"'`]|&(?!amp;)/g,function(t){return a[t]})}function r(t,e){return l[t]=e.replace(/^\s+|\s+$/g,""),this}function n(t,e){return r(e||t.getAttribute("rel"),t.innerHTML),t.parentNode.removeChild(t),this}function s(t,e){return p[t]=e||f[t],this}function i(){var t,e;if(document.querySelectorAll)t=document.querySelectorAll('script[type="'+c.tplType+'"][rel]');else{var r=document.getElementsByTagName("script");for(e=r.length,t=[];e--;)r[e].getAttribute("type")===c.tplType&&r[e].getAttribute("rel")&&t.push(r[e])}for(e=t.length;e--;)n(t[e]);return this}function u(t,e,r){var n,i;if(~e.indexOf("|")){var o,c,l,a=e.split("|");for(e=a.shift(),o=u(t,e,r),n=0,i=a.length;i>n;n++)a[n].match(/^\s*!?=/)?a[n].replace(/^\s*(!?)=(.*)\s*$/,function(t,e,r){o=e?o!=r?o:!1:o==r?o:!1}):(~(l=a[n].indexOf(":"))?((c=a[n].substr(l+1).split(",")).splice(0,0,o),a[n]=a[n].substr(0,l)):c=[o],p[a[n]]||s(a[n]),o=p[a[n]].apply(t,c));return o}for(e.match(/^\//)&&(e=e.substr(1),r="");e.match(/^..\//);)r=~r.indexOf(".")?"":r.replace(/\.[^\.]*$/,""),e=e.replace(/^..\//,"");if(e=e.replace(/^\.+/,""),r=r.replace(/^\/+/,"").replace(/^\.+/,""),e=(r||"")+(r&&e?".":"")+e,!e.length)return t;e=e.split(/\s*\.\s*/);var f=t;for(n=0,i=e.length;i>n;n++){if(!(e[n]in f))return null;f=f[e[n]]}return f}function o(t,r,n){return n||(n=""),t.replace(/\{\{\s*#([^\{\s]+?)\}\}([\s\S]*?)\{\{\/\1\}\}/g,function(t,e,s){var i,c=[],l=u(r,e,n),p=(n?n+".":"")+e;if(!l)return"";for(i in l)l.hasOwnProperty(i)&&c.push(o(s,r,p+"."+i));return c.join("")}).replace(/\{\{\s*(([^\{\s\|]+?)(\|[^\{\s]+?)?)\s*(!)?\?\s*\}\}([\s\S]*?)\{\{\s*\?\s*(\1|\2)\s*\}\}/g,function(t,e,s,i,c,l){var p=u(r,e,n),a=p?p instanceof Array?p.length:!0:!1;return c&&(a=!a),a?o(l,r,n):""}).replace(/\{\{\s*>\s*([a-z_][a-z_0-9-]*)\s*\}\}/gi,function(t,e){return l[e]?o(l[e],r,n):""}).replace(/\{\{\{\s*([^\{\s]*?)\s*\}\}\}/g,function(t,s){return e(u(r,s,n))}).replace(/\{\{\s*([^\{\s]*?)\s*\}\}/g,function(t,e){return u(r,e,n)})}function c(t,e){return void 0===l[t]&&(i(),void 0===l[t])?!1:o(l[t],e)}var l={},p={empty:function(t){return!!(!t||"0"===t||t instanceof Array&&!t.length)},jsonEncode:function(t){return JSON.stringify(t)},lowerCase:function(t){return(""+t).toLowerCase()},ucFirst:function(t){return t=""+t,t.substr(0,1).toUpperCase()+t.substr(1)},upperCase:function(t){return(""+t).toUpperCase()}},a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},f="undefined"!=typeof global?global:Function("return this;")();c.tplType="text/stpl",c.registerScriptTag=n,c.registerString=r,c.registerFilter=function(t,e){return s(t,e),this},c.preload=i,c.renderString=o,t.stpl=c})("object"==typeof exports?exports:this);